<!DOCTYPE html>
<meta charset="utf-8">
<body>

<div id="vanGogh"></div>
<canvas id="vincent"></canvas>
<!-- <script src="//d3js.org/d3.v3.min.js"></script> -->
<script src="d3.v3.min.js"></script>
<script src="van-Gogh-01.js"></script>
<script>
  var node = document.getElementById("vanGogh");
  var app  = Elm.VanGogh.embed(node);

  //

  app.ports.getPolygons.subscribe(
    function(){
      var width = 960;
      var height = 500;
      var samples = [];
      for(i = 0; i < 10000; i++) samples.push([ width*(Math.random()-0.5) >> 0 , height*(Math.random()-0.5) >> 0 ]);
      var polygons = d3.geom.voronoi(samples);
      app.ports.polygons.send( polygons );
    }
  );

  app.ports.getImageData.subscribe(
    function(){
        var width  = 960;
        var height = 500;
        var canvas = document.getElementById('vincent');
        var ctx = canvas.getContext("2d");

        var image = new Image();
        image.src= "starry-night.jpg";
        ctx.drawImage(image, 0, 0);

        var pixel = ctx.getImageData(0,0, width, height)

        // getImageData is not genuinely a list
        var pixels = [];
        for( var i = 0; i < pixel.data.length; i++){
          pixels.push(pixel.data[i]);
        }

        //console.log(pixels);
        app.ports.pixels.send( { "width": width, "height": height, "data": pixels } );
        console.log("pixels");
    }
  );
</script>

</body>
