<!DOCTYPE html>
<meta charset="utf-8">
<body>

<div id="vanGogh"></div>
<canvas id="vincent"></canvas>
<script src="//d3js.org/d3.v3.min.js"></script>
<!--<script src="d3.v3.min.js"></script> -->
<script src="van-Gogh-01.js"></script>
<script>
  var node = document.getElementById("vanGogh");
  var app  = Elm.VanGogh.embed(node);

  //

  app.ports.getPolygons.subscribe(
    function(){
      var width = 960;
      var height = 500;
      var samples = [];
      // for(i = 0; i < 10000; i++) samples.push([ width*(Math.random()-0.5), height*(Math.random()-0.5) ]);
      for(i = 0; i < 10000; i++) { a = (i % 100)/100; b = (i / 100 >> 0 )/ 100; samples.push([ width*(a-0.5), height*(b-0.5) ]); }
      var polygons = d3.geom.voronoi(samples);
      app.ports.polygons.send( polygons );
    }
  );

  app.ports.getImageData.subscribe(
    function(){
        var width  = 960;
        var height = 500;
        var canvas = document.getElementById('vincent');
        var ctx = canvas.getContext("2d");
        canvas.width  = width;
        canvas.height = height;

        var image = new Image();
        image.src= "starry-night.jpg";
        image.onload = function () {
          ctx.drawImage(image, 0, 0);

          var pixel = ctx.getImageData(0,0, width, height)

          // getImageData is not genuinely a List
          var pixels = [];
          for( var i = 0; i < pixel.data.length; i++){ pixels.push(pixel.data[i]); }

          console.log(pixels);
          app.ports.pixels.send( { "width": width, "height": height, "data": pixels } );
          console.log("pixels");
        }
    }
  );
</script>

</body>
